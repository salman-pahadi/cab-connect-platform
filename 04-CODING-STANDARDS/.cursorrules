# ğŸ¤– CAB CONNECT PHASE 1 - CURSOR/COPILOT RULES
## Auto-Development Configuration for AI Coding Assistants

**Project:** Cab Connect - Fiji's Cab-Hailing Platform  
**Phase:** Phase 1 (Android MVP)  
**Status:** Ready for Development  
**Last Updated:** January 11, 2026  

---

## ğŸ¯ CORE DIRECTIVES

### **YOU ARE BUILDING**
- âœ… FastAPI Backend (Python)
- âœ… React Native Passenger App (TypeScript)
- âœ… React Native Driver App (TypeScript)
- âœ… React Admin Dashboard (TypeScript)
- âœ… PostgreSQL Database
- âœ… Real-time WebSocket System
- âœ… Payment Integration (Razorpay)

### **YOU ARE NOT BUILDING**
- âŒ iOS apps (Phase 2)
- âŒ Web booking platform (Not needed)
- âŒ In-app wallet (Phase 4)
- âŒ Advanced features (Phase 5+)

### **QUALITY STANDARDS**
- âœ… 80%+ test coverage (backend)
- âœ… TypeScript strict mode (frontend)
- âœ… All APIs documented (Swagger)
- âœ… No hardcoded values
- âœ… Security best practices
- âœ… Error handling everywhere

---

## ğŸ“‹ PROJECT STRUCTURE

### **Backend (FastAPI)**
```
cab-connect-backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ main.py
â”‚   â”œâ”€â”€ config.py
â”‚   â”œâ”€â”€ api/v1/
â”‚   â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ schemas/
â”‚   â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ database/
â”‚   â””â”€â”€ websocket/
â”œâ”€â”€ tests/
â”œâ”€â”€ requirements.txt
â””â”€â”€ .env
```

### **Frontend (React Native)**
```
CabConnect/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ screens/
â”‚   â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ navigation/
â”‚   â”œâ”€â”€ redux/
â”‚   â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ types/
â”‚   â””â”€â”€ App.tsx
â”œâ”€â”€ app.json
â”œâ”€â”€ tsconfig.json
â””â”€â”€ package.json
```

### **Admin Dashboard (React)**
```
cab-connect-admin/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ store/
â”‚   â””â”€â”€ App.tsx
â”œâ”€â”€ public/
â”œâ”€â”€ tsconfig.json
â””â”€â”€ package.json
```

---

## ğŸ”‘ KEY TECHNOLOGIES

### **Backend**
```yaml
Runtime: Python 3.10+
Framework: FastAPI
ORM: SQLAlchemy
Database: PostgreSQL
Cache: Redis
Auth: JWT + SMS OTP
WebSocket: Starlette
Testing: Pytest
Deployment: Docker + AWS EC2
```

### **Frontend**
```yaml
Runtime: Node.js 18+
Framework: React Native (Expo)
Language: TypeScript (strict)
State: Redux Toolkit
Navigation: React Navigation
Maps: Google Maps
HTTP: Axios
Real-time: Socket.io
Testing: Jest
Build: Expo EAS Build
```

### **Admin Dashboard**
```yaml
Framework: React 18
Language: TypeScript
Styling: Tailwind CSS
State: Redux Toolkit
Charts: Recharts
Build: Vite
Testing: Vitest
```

---

## ğŸ—ï¸ ARCHITECTURE PATTERNS

### **Backend - REST API Pattern**
```python
# âœ… GOOD: Clean, documented, typed
@router.post("/api/v1/rides/request", response_model=RideResponse)
async def request_ride(
    ride_request: RideRequest,
    current_user: User = Depends(get_current_user),
    db: Session = Depends(get_db)
) -> RideResponse:
    """
    Request a new ride.
    
    - **ride_request**: Pickup and destination details
    - **current_user**: Authenticated passenger
    - **returns**: Ride details with estimated fare
    """
    service = RideService(db)
    ride = service.create_ride(current_user.id, ride_request)
    return RideResponse.from_orm(ride)

# âŒ BAD: Untyped, no docs, no error handling
@router.post("/rides")
async def request_ride(data):
    ride = create_ride(data)
    return ride
```

### **Frontend - Redux Pattern**
```typescript
// âœ… GOOD: Structured, typed actions
interface RideState {
  ride: Ride | null;
  status: 'idle' | 'loading' | 'error';
  error: string | null;
}

const rideSlice = createSlice({
  name: 'ride',
  initialState,
  reducers: {
    setRide: (state, action) => {
      state.ride = action.payload;
    },
  },
  extraReducers: (builder) => {
    builder
      .addCase(requestRide.pending, (state) => {
        state.status = 'loading';
      })
      .addCase(requestRide.fulfilled, (state, action) => {
        state.ride = action.payload;
        state.status = 'idle';
      });
  },
});

// âŒ BAD: Any types, no state structure
const rideReducer = (state: any = {}, action: any) => {
  if (action.type === 'SET_RIDE') {
    return { ...state, ride: action.payload };
  }
  return state;
};
```

---

## ğŸ”’ SECURITY RULES

### **Never Include**
```
âŒ API keys in code (use environment variables)
âŒ Database credentials (use env vars)
âŒ User passwords in logs
âŒ Phone numbers in error messages
âŒ Unvalidated user input in queries
âŒ CORS: allow_origins=["*"] in production
âŒ Console.log with sensitive data
âŒ Hardcoded tokens or secrets
```

### **Always Do**
```
âœ… Use environment variables for all secrets
âœ… Validate input on backend
âœ… Hash passwords with bcrypt
âœ… Use HTTPS only
âœ… JWT tokens for API auth
âœ… Rate limiting on endpoints
âœ… CORS with specific origins
âœ… SQL injection prevention (use ORM)
âœ… Error handling without exposing internals
âœ… Logging without PII
```

---

## ğŸ“ CODING STANDARDS

### **Python (Backend)**

**File Naming:**
```
âœ… auth_service.py, user_model.py, ride_routes.py
âŒ AuthService.py, User.py, ridesAPI.py
```

**Code Structure:**
```python
# âœ… GOOD: Organized, typed, documented
from typing import Optional, List
from pydantic import BaseModel, Field
from sqlalchemy import Column, String
from datetime import datetime

class RideRequest(BaseModel):
    """Schema for creating a ride request"""
    pickup_address: str = Field(..., min_length=5)
    destination_address: str = Field(..., min_length=5)
    passenger_count: int = Field(default=1, ge=1, le=6)

class Ride(Base):
    """ORM model for rides"""
    __tablename__ = "rides"
    
    id = Column(UUID, primary_key=True, default=uuid4)
    passenger_id = Column(UUID, ForeignKey("users.id"), nullable=False)
    status = Column(String(20), default="pending")
    created_at = Column(DateTime, default=datetime.utcnow)
    
    def __repr__(self) -> str:
        return f"<Ride {self.id}>"

async def create_ride(
    passenger_id: str,
    ride_request: RideRequest,
    db: Session
) -> Ride:
    """Create a new ride request"""
    ride = Ride(
        passenger_id=passenger_id,
        pickup_address=ride_request.pickup_address,
        destination_address=ride_request.destination_address
    )
    db.add(ride)
    db.commit()
    db.refresh(ride)
    return ride

# âŒ BAD: No types, no docs
def create_ride(pid, data, db):
    r = Ride(passenger_id=pid, pickup=data['pickup'])
    db.add(r)
    db.commit()
    return r
```

**Testing:**
```python
# âœ… GOOD: Clear test cases, assertions
def test_create_ride_success(db_session):
    """Test successful ride creation"""
    ride = create_ride("user123", RideRequest(...), db_session)
    assert ride.id is not None
    assert ride.status == "pending"

def test_create_ride_invalid_passenger(db_session):
    """Test ride creation with invalid passenger"""
    with pytest.raises(ValueError):
        create_ride("invalid_id", RideRequest(...), db_session)

# âŒ BAD: Unclear tests
def test_ride(db):
    r = create_ride("u1", {"p": "a"}, db)
    assert r
```

---

### **TypeScript (Frontend)**

**File Naming:**
```
âœ… HomeScreen.tsx, rideSlice.ts, useGeolocation.ts
âŒ homescreen.tsx, Ride_Slice.ts, GetGeolocation.ts
```

**Code Structure:**
```typescript
// âœ… GOOD: Typed, organized, documented
import { useState, useEffect } from 'react';
import { useDispatch, useSelector } from 'react-redux';
import { RootState } from '@/redux/store';
import * as rideService from '@/services/rideService';

interface HomeScreenProps {
  navigation: NativeStackNavigationProp<RootStackParamList, 'Home'>;
}

export default function HomeScreen({ navigation }: HomeScreenProps) {
  const [currentLocation, setCurrentLocation] = useState<Location | null>(null);
  const [nearbyDrivers, setNearbyDrivers] = useState<Driver[]>([]);
  const [error, setError] = useState<string | null>(null);
  const ride = useSelector((state: RootState) => state.ride.ride);

  useEffect(() => {
    const startLocationTracking = async () => {
      try {
        const location = await getLocation();
        setCurrentLocation(location);
      } catch (err) {
        setError(err.message);
      }
    };

    startLocationTracking();
  }, []);

  const handleBookRide = async () => {
    try {
      const response = await rideService.requestRide(currentLocation);
      dispatch(setRide(response));
    } catch (error) {
      setError(error.message);
    }
  };

  if (error) return <ErrorScreen message={error} />;
  if (!currentLocation) return <LoadingScreen />;

  return (
    <View style={styles.container}>
      {/* UI */}
    </View>
  );
}

// âŒ BAD: No types, no error handling
export default function HomeScreen({ navigation }) {
  const [location, setLocation] = useState();
  const ride = useSelector(state => state.ride);

  useEffect(() => {
    getLocation().then(loc => setLocation(loc));
  }, []);

  return <View>{/* UI */}</View>;
}
```

---

## ğŸ§ª TESTING REQUIREMENTS

### **Backend Testing** (pytest)
```python
# Minimum coverage: 80%

# Unit Tests
test_auth_service.py        # Auth logic
test_ride_service.py        # Ride logic
test_payment_service.py     # Payment logic

# Integration Tests
test_auth_routes.py         # API endpoints
test_ride_routes.py
test_payment_routes.py

# Run: pytest -v --cov=app --cov-report=html
```

### **Frontend Testing** (Jest)
```typescript
// Minimum coverage: 60%

// Component Tests
HomeScreen.test.tsx
BookingScreen.test.tsx
RideScreen.test.tsx

// Hook Tests
useGeolocation.test.ts
useRideTracking.test.ts

// Run: npm test -- --coverage
```

---

## ğŸ“š DOCUMENTATION REQUIREMENTS

### **Each Module Must Have**
```
1. README.md
   - Overview
   - Setup instructions
   - API endpoints (if backend)
   - Usage examples

2. Code Comments
   - Complex logic explained
   - Business rules documented
   - Assumptions stated

3. Type Definitions
   - All function parameters typed
   - Return types specified
   - Interfaces documented

4. Error Handling
   - Error cases documented
   - Recovery strategies described
```

---

## ğŸ”„ DEVELOPMENT WORKFLOW

### **Before Writing Code**
```
1. Check project structure matches rules
2. Verify types/interfaces are defined
3. Review similar existing code
4. Plan error scenarios
5. Write tests first (TDD preferred)
```

### **While Writing Code**
```
1. Follow naming conventions
2. Add type annotations
3. Write docstrings/comments
4. Handle errors explicitly
5. No console logs in production code
6. No magic numbers (use constants)
```

### **Before Committing**
```
1. Tests passing (100%)
2. Linting passing
3. Type checking passing
4. No console errors
5. Commit message clear (feat:, fix:, etc.)
```

---

## ğŸš€ GIT WORKFLOW

### **Branch Naming**
```
feature/user-authentication
fix/ride-calculation-bug
refactor/database-queries
docs/api-documentation
```

### **Commit Messages**
```
feat: add OTP verification endpoint
fix: resolve null pointer in location tracking
refactor: optimize database queries
test: add auth service unit tests
docs: update API documentation
chore: update dependencies
```

### **Pull Request Template**
```markdown
## Description
Brief description of changes

## Type
- [ ] Feature
- [ ] Bug fix
- [ ] Documentation
- [ ] Refactor

## Testing
- [ ] Unit tests added
- [ ] Integration tests added
- [ ] Manual testing done

## Checklist
- [ ] Code follows style guidelines
- [ ] No console errors
- [ ] Tests passing
- [ ] Documentation updated
```

---

## ğŸ“ SPECIFIC MODULE RULES

### **Authentication Module**

**Backend:**
```
POST /api/v1/auth/send-otp
POST /api/v1/auth/verify-otp
POST /api/v1/auth/login
POST /api/v1/auth/refresh
POST /api/v1/auth/logout
```

**Requirements:**
```
âœ… SMS OTP generation (6 digits, 10 min expiry)
âœ… JWT tokens (access: 24h, refresh: 7d)
âœ… Password hashing (bcrypt)
âœ… Rate limiting (5 attempts/minute)
âœ… Refresh token rotation
âœ… OTP retry logic (max 3 attempts)
```

### **Ride Management Module**

**Backend Endpoints:**
```
POST /api/v1/rides/request
GET /api/v1/rides/estimate
GET /api/v1/rides/active
PUT /api/v1/rides/:id/status
GET /api/v1/rides/history
```

**Requirements:**
```
âœ… Fare calculation (base + distance + time)
âœ… Driver matching algorithm
âœ… Real-time status updates
âœ… Ride cancellation logic
âœ… Payment integration
âœ… Rating system
```

### **Location Service Module**

**Backend Endpoints:**
```
GET /api/v1/location/nearby-drivers
POST /api/v1/location/update
GET /api/v1/location/directions
```

**Requirements:**
```
âœ… Geospatial queries (PostGIS)
âœ… Real-time location tracking
âœ… Distance calculation
âœ… Route optimization
âœ… Location accuracy validation
```

---

## ğŸ¨ UI/BRANDING GUIDELINES

### **Brand Colors**
```
Primary Green: #10b981
Secondary Blue: #0891b2
Accent Gold: #f59e0b
Neutral Dark: #1f2937
Neutral Light: #f9fafb
```

### **Typography**
```
Headings: Plus Jakarta Sans Bold (or system font)
Body: Plus Jakarta Sans Regular
Size: Responsive (12-18px mobile, 14-20px tablet)
```

### **Component Styles**
```
Buttons: 44px height (touch-friendly)
Input Fields: 48px height
Card Radius: 12px
Icons: 24-32px
Padding: 16-20px sections
```

---

## âš ï¸ COMMON MISTAKES TO AVOID

```
âŒ Writing frontend code without types
âŒ API endpoints without error handling
âŒ Database queries without indexes
âŒ Real-time updates without WebSocket
âŒ No validation on user input
âŒ Passwords in logs or errors
âŒ Console.log in production
âŒ Magic numbers (no constants)
âŒ Functions > 50 lines
âŒ No unit tests
âŒ Hardcoded API URLs
âŒ No database migrations
```

---

## ğŸ› ï¸ USEFUL SETUP COMMANDS

### **Backend**
```bash
# Setup
python -m venv venv
source venv/bin/activate
pip install -r requirements.txt
python -m alembic init migrations

# Run
uvicorn app.main:app --reload

# Test
pytest -v --cov=app
black app/
flake8 app/
mypy app/
```

### **Frontend**
```bash
# Setup
npx create-expo-app CabConnect
cd CabConnect
npm install

# Run
npm start
npm run android
npm run ios

# Test
npm test -- --coverage
npm run lint
```

### **Docker**
```bash
# Build
docker build -t cabconnect-backend .
docker-compose up

# Test
docker-compose exec web pytest
```

---

## ğŸ“ WHEN TO ESCALATE

```
ğŸ”´ Critical: System down, data loss, security breach
ğŸŸ¡ High: Feature broken, API endpoint failing
ğŸŸ¢ Medium: UI issue, performance degradation
ğŸ”µ Low: Minor bug, documentation update
```

**Escalation:**
1. Document the issue
2. Create GitHub issue
3. Notify team lead
4. Add to sprint planning

---

## ğŸ“ LEARNING RESOURCES

```
FastAPI: https://fastapi.tiangolo.com/
React Native: https://reactnative.dev/
PostgreSQL: https://www.postgresql.org/docs/
TypeScript: https://www.typescriptlang.org/
Redux: https://redux.js.org/
WebSockets: https://developer.mozilla.org/en-US/docs/Web/API/WebSocket
```

---

## ğŸ“‹ CHECKLIST BEFORE DEPLOYMENT

```
Backend:
â˜ All tests passing (80%+ coverage)
â˜ API documentation complete
â˜ Error handling comprehensive
â˜ Security audit done
â˜ Database migrations tested
â˜ Environment variables set
â˜ Logging configured
â˜ Rate limiting working

Frontend:
â˜ All screens working
â˜ No TypeScript errors
â˜ No console errors
â˜ Device testing done (5+ devices)
â˜ Performance optimized
â˜ Offline functionality tested
â˜ Notifications working

Admin:
â˜ All pages functional
â˜ Charts rendering correctly
â˜ Real-time updates working
â˜ CRUD operations tested

General:
â˜ Git history clean
â˜ Documentation complete
â˜ Monitoring configured
â˜ Backup strategy in place
```

---

**Version:** 1.0  
**Last Updated:** January 11, 2026  
**Status:** Ready for Development  

---
